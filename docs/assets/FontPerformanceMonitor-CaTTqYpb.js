import{j as e}from"./framer-motion-CXdLbqfN.js";import{r as t}from"./react-vendor-DQmNySUk.js";import{f as o,g as r,m as n}from"./index-DhpcxLL-.js";import"./mermaid-core-BSOLjsMK.js";import"./d3-charts-C9eKmPJg.js";import"./vendor-kie2PU7Z.js";import"./react-icons-mdDy3BM0.js";const i=r("FontPerformanceMonitor"),s=({visible:r=!1,position:s="bottom-right"})=>{const[a,d]=t.useState({loadedFonts:[],cacheStats:{size:0,memoryUsage:0,memoryUsageMB:0,averageAccessCount:0},performanceMetrics:{fontLoadTime:0,cacheHitRate:0,totalRequests:0,renderTime:0,lastUpdateTime:Date.now()},systemInfo:{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onlineStatus:navigator.onLine}}),[c,l]=t.useState(!1);return t.useEffect(()=>{if(!r)return;const e=()=>{try{const e=performance.now(),t=o.getLoadedFonts(),r=o.getCacheStats(),n=performance.getEntriesByType("navigation")[0]?.loadEventEnd||0,s=performance.now()-e;d(e=>({loadedFonts:t,cacheStats:r,performanceMetrics:{fontLoadTime:n,cacheHitRate:r.size>0?r.averageAccessCount/r.size*100:0,totalRequests:r.size,renderTime:s,lastUpdateTime:Date.now()},systemInfo:{...e.systemInfo,onlineStatus:navigator.onLine}})),i(`Font stats updated: ${t.length} fonts loaded, ${r.memoryUsageMB.toFixed(2)}MB cached, render: ${s.toFixed(2)}ms`)}catch(e){i.extend("error")("Failed to update font stats:",e)}};e();const t=setInterval(e,5e3);return()=>clearInterval(t)},[r]),r?e.jsxs("div",{"data-testid":"font-performance-monitor",className:"font-performance-monitor",style:{position:"fixed",...{"top-left":{top:"20px",left:"20px"},"top-right":{top:"20px",right:"20px"},"bottom-left":{bottom:"20px",left:"20px"},"bottom-right":{bottom:"20px",right:"20px"}}[s],backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"10px",borderRadius:"8px",fontSize:"12px",fontFamily:"monospace",zIndex:9999,minWidth:"200px",maxWidth:"400px",backdropFilter:"blur(5px)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",marginBottom:c?"10px":"0"},onClick:()=>l(!c),children:[e.jsx("span",{children:"🎨 字体性能监控"}),e.jsx("span",{children:c?"▼":"▶"})]}),c&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"📊 基本统计"}),e.jsxs("div",{children:["已加载字体: ",a.loadedFonts.length]}),e.jsxs("div",{children:["缓存项目: ",a.cacheStats.size]}),e.jsxs("div",{children:["缓存内存: ",a.cacheStats.memoryUsageMB.toFixed(2),"MB"]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"⚡ 性能指标"}),e.jsxs("div",{children:["加载时间: ",a.performanceMetrics.fontLoadTime.toFixed(0),"ms"]}),e.jsxs("div",{children:["渲染时间: ",a.performanceMetrics.renderTime.toFixed(2),"ms"]}),e.jsxs("div",{children:["缓存命中率: ",a.performanceMetrics.cacheHitRate.toFixed(1),"%"]}),e.jsxs("div",{children:["平均访问: ",a.cacheStats.averageAccessCount.toFixed(1)]}),e.jsxs("div",{style:{fontSize:"10px",opacity:.7},children:["更新时间: ",new Date(a.performanceMetrics.lastUpdateTime).toLocaleTimeString()]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"🖥️ 系统信息"}),e.jsxs("div",{style:{fontSize:"10px",opacity:.8},children:[e.jsxs("div",{children:["平台: ",a.systemInfo.platform]}),e.jsxs("div",{children:["语言: ",a.systemInfo.language]}),e.jsxs("div",{children:["在线: ",a.systemInfo.onlineStatus?"✅":"❌"]}),e.jsxs("div",{children:["Cookie: ",a.systemInfo.cookieEnabled?"✅":"❌"]})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"🎯 已加载字体"}),e.jsx("div",{style:{maxHeight:"100px",overflowY:"auto"},children:a.loadedFonts.length>0?a.loadedFonts.map((t,o)=>e.jsxs("div",{style:{fontSize:"10px",opacity:.8},children:["• ",t]},o)):e.jsx("div",{style:{fontSize:"10px",opacity:.6},children:"暂无已加载字体"})})]}),e.jsxs("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>{o.clearCache(),i("Font cache cleared manually")},style:{backgroundColor:"#ff4444",color:"white",border:"none",padding:"3px 6px",borderRadius:"3px",fontSize:"9px",cursor:"pointer"},children:"清理缓存"}),e.jsx("button",{onClick:()=>{n.logMemoryUsage(),i("Memory cleanup triggered")},style:{backgroundColor:"#4444ff",color:"white",border:"none",padding:"3px 6px",borderRadius:"3px",fontSize:"9px",cursor:"pointer"},children:"内存检查"}),e.jsx("button",{onClick:()=>{const e={timestamp:(new Date).toISOString(),stats:a,performance:{navigation:performance.getEntriesByType("navigation")[0],memory:performance.memory,timing:performance.timing}},t=JSON.stringify(e,null,2),o=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(o),n=document.createElement("a");n.href=r,n.download=`font-performance-${Date.now()}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),i("Performance data exported")},style:{backgroundColor:"#44aa44",color:"white",border:"none",padding:"3px 6px",borderRadius:"3px",fontSize:"9px",cursor:"pointer"},children:"导出数据"}),e.jsx("button",{onClick:()=>{performance.clearMarks(),performance.clearMeasures(),d(e=>({...e,performanceMetrics:{...e.performanceMetrics,lastUpdateTime:Date.now()}})),i("Performance stats reset")},style:{backgroundColor:"#aa8844",color:"white",border:"none",padding:"3px 6px",borderRadius:"3px",fontSize:"9px",cursor:"pointer"},children:"重置统计"})]})]})]}):null};export{s as FontPerformanceMonitor,s as default};
