import{a as e,g as t,s as r,b as i,c as s,q as o,p as n,I as a,V as c,E as d,F as l,G as f,y as h,l as p,a0 as g,d as u,aa as m,ab as y,ac as w}from"./mermaid-core-CxzdCigi.js";import{p as k}from"./chunk-353BL4L5-CbfpvhZL.js";import{I as x}from"./chunk-AACKK3MU-Dd0ya460.js";import{p as b}from"./treemap-6Y5VK53G-zDneqk0b.js";import{c as v,f as $}from"./cytoscape-3nCDfVzk.js";import{u as E}from"./d3-charts-C9eKmPJg.js";import"./react-vendor-DQmNySUk.js";import"./_baseUniq-jCaBlI5l.js";import"./_basePickBy-BhhVUbw9.js";import"./clone-D_1IP6a6.js";var T={L:"left",R:"right",T:"top",B:"bottom"},I={L:e(e=>`${e},${e/2} 0,${e} 0,0`,"L"),R:e(e=>`0,${e/2} ${e},0 ${e},${e}`,"R"),T:e(e=>`0,0 ${e},0 ${e/2},${e}`,"T"),B:e(e=>`${e/2},0 ${e},${e} 0,${e}`,"B")},j={L:e((e,t)=>e-t+2,"L"),R:e((e,t)=>e-2,"R"),T:e((e,t)=>e-t+2,"T"),B:e((e,t)=>e-2,"B")},D=e(function(e){return B(e)?"L"===e?"R":"L":"T"===e?"B":"T"},"getOppositeArchitectureDirection"),L=e(function(e){return"L"===e||"R"===e||"T"===e||"B"===e},"isArchitectureDirection"),B=e(function(e){return"L"===e||"R"===e},"isArchitectureDirectionX"),S=e(function(e){return"T"===e||"B"===e},"isArchitectureDirectionY"),A=e(function(e,t){const r=B(e)&&S(t),i=S(e)&&B(t);return r||i},"isArchitectureDirectionXY"),z=e(function(e){const t=e[0],r=e[1],i=B(t)&&S(r),s=S(t)&&B(r);return i||s},"isArchitecturePairXY"),G=e(function(e){return"LL"!==e&&"RR"!==e&&"TT"!==e&&"BB"!==e},"isValidArchitectureDirectionPair"),O=e(function(e,t){const r=`${e}${t}`;return G(r)?r:void 0},"getArchitectureDirectionPair"),R=e(function([e,t],r){const i=r[0],s=r[1];return B(i)?S(s)?[e+("L"===i?-1:1),t+("T"===s?1:-1)]:[e+("L"===i?-1:1),t]:B(s)?[e+("L"===s?1:-1),t+("T"===i?1:-1)]:[e,t+("T"===i?1:-1)]},"shiftPositionByArchitectureDirectionPair"),M=e(function(e){return"LT"===e||"TL"===e?[1,1]:"BL"===e||"LB"===e?[1,-1]:"BR"===e||"RB"===e?[-1,-1]:[-1,1]},"getArchitectureDirectionXYFactors"),P=e(function(e,t){return A(e,t)?"bend":B(e)?"horizontal":"vertical"},"getArchitectureDirectionAlignment"),C=e(function(e){return"service"===e.type},"isArchitectureService"),N=e(function(e){return"junction"===e.type},"isArchitectureJunction"),Y=e(e=>e.data(),"edgeData"),J=e(e=>e.data(),"nodeData"),X=f.architecture,Z=new x(()=>({nodes:{},groups:{},edges:[],registeredIds:{},config:X,dataStructures:void 0,elements:{}})),q=e(()=>{Z.reset(),h()},"clear"),F=e(function({id:e,icon:t,in:r,title:i,iconText:s}){if(void 0!==Z.records.registeredIds[e])throw new Error(`The service id [${e}] is already in use by another ${Z.records.registeredIds[e]}`);if(void 0!==r){if(e===r)throw new Error(`The service [${e}] cannot be placed within itself`);if(void 0===Z.records.registeredIds[r])throw new Error(`The service [${e}]'s parent does not exist. Please make sure the parent is created before this service`);if("node"===Z.records.registeredIds[r])throw new Error(`The service [${e}]'s parent is not a group`)}Z.records.registeredIds[e]="node",Z.records.nodes[e]={id:e,type:"service",icon:t,iconText:s,title:i,edges:[],in:r}},"addService"),H=e(()=>Object.values(Z.records.nodes).filter(C),"getServices"),_=e(function({id:e,in:t}){Z.records.registeredIds[e]="node",Z.records.nodes[e]={id:e,type:"junction",edges:[],in:t}},"addJunction"),V=e(()=>Object.values(Z.records.nodes).filter(N),"getJunctions"),W=e(()=>Object.values(Z.records.nodes),"getNodes"),K=e(e=>Z.records.nodes[e],"getNode"),U=e(function({id:e,icon:t,in:r,title:i}){if(void 0!==Z.records.registeredIds[e])throw new Error(`The group id [${e}] is already in use by another ${Z.records.registeredIds[e]}`);if(void 0!==r){if(e===r)throw new Error(`The group [${e}] cannot be placed within itself`);if(void 0===Z.records.registeredIds[r])throw new Error(`The group [${e}]'s parent does not exist. Please make sure the parent is created before this group`);if("node"===Z.records.registeredIds[r])throw new Error(`The group [${e}]'s parent is not a group`)}Z.records.registeredIds[e]="group",Z.records.groups[e]={id:e,icon:t,title:i,in:r}},"addGroup"),Q=e(()=>Object.values(Z.records.groups),"getGroups"),ee=e(function({lhsId:e,rhsId:t,lhsDir:r,rhsDir:i,lhsInto:s,rhsInto:o,lhsGroup:n,rhsGroup:a,title:c}){if(!L(r))throw new Error(`Invalid direction given for left hand side of edge ${e}--${t}. Expected (L,R,T,B) got ${r}`);if(!L(i))throw new Error(`Invalid direction given for right hand side of edge ${e}--${t}. Expected (L,R,T,B) got ${i}`);if(void 0===Z.records.nodes[e]&&void 0===Z.records.groups[e])throw new Error(`The left-hand id [${e}] does not yet exist. Please create the service/group before declaring an edge to it.`);if(void 0===Z.records.nodes[t]&&void 0===Z.records.groups[e])throw new Error(`The right-hand id [${t}] does not yet exist. Please create the service/group before declaring an edge to it.`);const d=Z.records.nodes[e].in,l=Z.records.nodes[t].in;if(n&&d&&l&&d==l)throw new Error(`The left-hand id [${e}] is modified to traverse the group boundary, but the edge does not pass through two groups.`);if(a&&d&&l&&d==l)throw new Error(`The right-hand id [${t}] is modified to traverse the group boundary, but the edge does not pass through two groups.`);const f={lhsId:e,lhsDir:r,lhsInto:s,lhsGroup:n,rhsId:t,rhsDir:i,rhsInto:o,rhsGroup:a,title:c};Z.records.edges.push(f),Z.records.nodes[e]&&Z.records.nodes[t]&&(Z.records.nodes[e].edges.push(Z.records.edges[Z.records.edges.length-1]),Z.records.nodes[t].edges.push(Z.records.edges[Z.records.edges.length-1]))},"addEdge"),te=e(()=>Z.records.edges,"getEdges"),re=e(()=>{if(void 0===Z.records.dataStructures){const t={},r=Object.entries(Z.records.nodes).reduce((e,[r,i])=>(e[r]=i.edges.reduce((e,i)=>{const s=K(i.lhsId)?.in,o=K(i.rhsId)?.in;if(s&&o&&s!==o){const e=P(i.lhsDir,i.rhsDir);"bend"!==e&&(t[s]??={},t[s][o]=e,t[o]??={},t[o][s]=e)}if(i.lhsId===r){const t=O(i.lhsDir,i.rhsDir);t&&(e[t]=i.rhsId)}else{const t=O(i.rhsDir,i.lhsDir);t&&(e[t]=i.lhsId)}return e},{}),e),{}),i=Object.keys(r)[0],s={[i]:1},o=Object.keys(r).reduce((e,t)=>t===i?e:{...e,[t]:1},{}),n=e(e=>{const t={[e]:[0,0]},i=[e];for(;i.length>0;){const e=i.shift();if(e){s[e]=1,delete o[e];const n=r[e],[a,c]=t[e];Object.entries(n).forEach(([e,r])=>{s[r]||(t[r]=R([a,c],e),i.push(r))})}}return t},"BFS"),a=[n(i)];for(;Object.keys(o).length>0;)a.push(n(Object.keys(o)[0]));Z.records.dataStructures={adjList:r,spatialMaps:a,groupAlignments:t}}return Z.records.dataStructures},"getDataStructures"),ie=e((e,t)=>{Z.records.elements[e]=t},"setElementForId"),se=e(e=>Z.records.elements[e],"getElementById"),oe=e(()=>d({...X,...l().architecture}),"getConfig"),ne={clear:q,setDiagramTitle:n,getDiagramTitle:o,setAccTitle:s,getAccTitle:i,setAccDescription:r,getAccDescription:t,getConfig:oe,addService:F,getServices:H,addJunction:_,getJunctions:V,getNodes:W,getNode:K,addGroup:U,getGroups:Q,addEdge:ee,getEdges:te,setElementForId:ie,getElementById:se,getDataStructures:re};function ae(e){return oe()[e]}e(ae,"getConfigField");var ce=e((e,t)=>{k(e,t),e.groups.map(t.addGroup),e.services.map(e=>t.addService({...e,type:"service"})),e.junctions.map(e=>t.addJunction({...e,type:"junction"})),e.edges.map(t.addEdge)},"populateDb"),de={parse:e(async e=>{const t=await b("architecture",e);p.debug(t),ce(t,ne)},"parse")},le=e(e=>`\n  .edge {\n    stroke-width: ${e.archEdgeWidth};\n    stroke: ${e.archEdgeColor};\n    fill: none;\n  }\n\n  .arrow {\n    fill: ${e.archEdgeArrowColor};\n  }\n\n  .node-bkg {\n    fill: none;\n    stroke: ${e.archGroupBorderColor};\n    stroke-width: ${e.archGroupBorderWidth};\n    stroke-dasharray: 8;\n  }\n  .node-icon-text {\n    display: flex; \n    align-items: center;\n  }\n  \n  .node-icon-text > div {\n    color: #fff;\n    margin: 1px;\n    height: fit-content;\n    text-align: center;\n    overflow: hidden;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n  }\n`,"getStyles"),fe=e(e=>`<g><rect width="80" height="80" style="fill: #087ebf; stroke-width: 0px;"/>${e}</g>`,"wrapIcon"),he={prefix:"mermaid-architecture",height:80,width:80,icons:{database:{body:fe('<path id="b" data-name="4" d="m20,57.86c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path id="c" data-name="3" d="m20,45.95c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path id="d" data-name="2" d="m20,34.05c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse id="e" data-name="1" cx="40" cy="22.14" rx="20" ry="7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="20" y1="57.86" x2="20" y2="22.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="60" y1="57.86" x2="60" y2="22.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},server:{body:fe('<rect x="17.5" y="17.5" width="45" height="45" rx="2" ry="2" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="32.5" x2="62.5" y2="32.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="47.5" x2="62.5" y2="47.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><g><path d="m56.25,25c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,25c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><path d="m56.25,40c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,40c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><path d="m56.25,55c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,55c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g>')},disk:{body:fe('<rect x="20" y="15" width="40" height="50" rx="1" ry="1" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="24" cy="19.17" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="56" cy="19.17" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="24" cy="60.83" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="56" cy="60.83" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="40" cy="33.75" rx="14" ry="14.58" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="40" cy="33.75" rx="4" ry="4.17" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m37.51,42.52l-4.83,13.22c-.26.71-1.1,1.02-1.76.64l-4.18-2.42c-.66-.38-.81-1.26-.33-1.84l9.01-10.8c.88-1.05,2.56-.08,2.09,1.2Z" style="fill: #fff; stroke-width: 0px;"/>')},internet:{body:fe('<circle cx="40" cy="40" r="22.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="40" y1="17.5" x2="40" y2="62.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="40" x2="62.5" y2="40" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m39.99,17.51c-15.28,11.1-15.28,33.88,0,44.98" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m40.01,17.51c15.28,11.1,15.28,33.88,0,44.98" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="19.75" y1="30.1" x2="60.25" y2="30.1" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="19.75" y1="49.9" x2="60.25" y2="49.9" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},cloud:{body:fe('<path d="m65,47.5c0,2.76-2.24,5-5,5H20c-2.76,0-5-2.24-5-5,0-1.87,1.03-3.51,2.56-4.36-.04-.21-.06-.42-.06-.64,0-2.6,2.48-4.74,5.65-4.97,1.65-4.51,6.34-7.76,11.85-7.76.86,0,1.69.08,2.5.23,2.09-1.57,4.69-2.5,7.5-2.5,6.1,0,11.19,4.38,12.28,10.17,2.14.56,3.72,2.51,3.72,4.83,0,.03,0,.07-.01.1,2.29.46,4.01,2.48,4.01,4.9Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},unknown:w,blank:{body:fe("")}}},pe=e(async function(e,t){const r=ae("padding"),i=ae("iconSize"),s=i/2,o=i/6,n=o/2;await Promise.all(t.edges().map(async t=>{const{source:i,sourceDir:a,sourceArrow:c,sourceGroup:d,target:l,targetDir:f,targetArrow:h,targetGroup:p,label:m}=Y(t);let{x:y,y:w}=t[0].sourceEndpoint();const{x:k,y:x}=t[0].midpoint();let{x:b,y:v}=t[0].targetEndpoint();const $=r+4;if(d&&(B(a)?y+="L"===a?-$:$:w+="T"===a?-$:$+18),p&&(B(f)?b+="L"===f?-$:$:v+="T"===f?-$:$+18),d||"junction"!==ne.getNode(i)?.type||(B(a)?y+="L"===a?s:-s:w+="T"===a?s:-s),p||"junction"!==ne.getNode(l)?.type||(B(f)?b+="L"===f?s:-s:v+="T"===f?s:-s),t[0]._private.rscratch){const t=e.insert("g");if(t.insert("path").attr("d",`M ${y},${w} L ${k},${x} L${b},${v} `).attr("class","edge"),c){const e=B(a)?j[a](y,o):y-n,r=S(a)?j[a](w,o):w-n;t.insert("polygon").attr("points",I[a](o)).attr("transform",`translate(${e},${r})`).attr("class","arrow")}if(h){const e=B(f)?j[f](b,o):b-n,r=S(f)?j[f](v,o):v-n;t.insert("polygon").attr("points",I[f](o)).attr("transform",`translate(${e},${r})`).attr("class","arrow")}if(m){const e=A(a,f)?"XY":B(a)?"X":"Y";let r=0;r="X"===e?Math.abs(y-b):"Y"===e?Math.abs(w-v)/1.5:Math.abs(y-b)/2;const i=t.append("g");if(await g(i,m,{useHtmlLabels:!1,width:r,classes:"architecture-service-label"},u()),i.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","middle").attr("text-anchor","middle"),"X"===e)i.attr("transform","translate("+k+", "+x+")");else if("Y"===e)i.attr("transform","translate("+k+", "+x+") rotate(-90)");else if("XY"===e){const e=O(a,f);if(e&&z(e)){const t=i.node().getBoundingClientRect(),[r,s]=M(e);i.attr("dominant-baseline","auto").attr("transform",`rotate(${-1*r*s*45})`);const o=i.node().getBoundingClientRect();i.attr("transform",`\n                translate(${k}, ${x-t.height/2})\n                translate(${r*o.width/2}, ${s*o.height/2})\n                rotate(${-1*r*s*45}, 0, ${t.height/2})\n              `)}}}}}))},"drawEdges"),ge=e(async function(e,t){const r=.75*ae("padding"),i=ae("fontSize"),s=ae("iconSize")/2;await Promise.all(t.nodes().map(async t=>{const o=J(t);if("group"===o.type){const{h:n,w:a,x1:c,y1:d}=t.boundingBox();e.append("rect").attr("x",c+s).attr("y",d+s).attr("width",a).attr("height",n).attr("class","node-bkg");const l=e.append("g");let f=c,h=d;if(o.icon){const e=l.append("g");e.html(`<g>${await m(o.icon,{height:r,width:r,fallbackPrefix:he.prefix})}</g>`),e.attr("transform","translate("+(f+s+1)+", "+(h+s+1)+")"),f+=r,h+=i/2-1-2}if(o.label){const e=l.append("g");await g(e,o.label,{useHtmlLabels:!1,width:a,classes:"architecture-service-label"},u()),e.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","start").attr("text-anchor","start"),e.attr("transform","translate("+(f+s+4)+", "+(h+s+2)+")")}}}))},"drawGroups"),ue=e(async function(e,t,r){for(const i of r){const r=t.append("g"),s=ae("iconSize");if(i.title){const e=r.append("g");await g(e,i.title,{useHtmlLabels:!1,width:1.5*s,classes:"architecture-service-label"},u()),e.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","middle").attr("text-anchor","middle"),e.attr("transform","translate("+s/2+", "+s+")")}const o=r.append("g");if(i.icon)o.html(`<g>${await m(i.icon,{height:s,width:s,fallbackPrefix:he.prefix})}</g>`);else if(i.iconText){o.html(`<g>${await m("blank",{height:s,width:s,fallbackPrefix:he.prefix})}</g>`);const e=o.append("g").append("foreignObject").attr("width",s).attr("height",s).append("div").attr("class","node-icon-text").attr("style",`height: ${s}px;`).append("div").html(i.iconText),t=parseInt(window.getComputedStyle(e.node(),null).getPropertyValue("font-size").replace(/\D/g,""))??16;e.attr("style",`-webkit-line-clamp: ${Math.floor((s-2)/t)};`)}else o.append("path").attr("class","node-bkg").attr("id","node-"+i.id).attr("d",`M0 ${s} v${-s} q0,-5 5,-5 h${s} q5,0 5,5 v${s} H0 Z`);r.attr("class","architecture-service");const{width:n,height:a}=r._groups[0][0].getBBox();i.width=n,i.height=a,e.setElementForId(i.id,r)}return 0},"drawServices"),me=e(function(e,t,r){r.forEach(r=>{const i=t.append("g"),s=ae("iconSize");i.append("g").append("rect").attr("id","node-"+r.id).attr("fill-opacity","0").attr("width",s).attr("height",s),i.attr("class","architecture-junction");const{width:o,height:n}=i._groups[0][0].getBBox();i.width=o,i.height=n,e.setElementForId(r.id,i)})},"drawJunctions");function ye(e,t){e.forEach(e=>{t.add({group:"nodes",data:{type:"service",id:e.id,icon:e.icon,label:e.title,parent:e.in,width:ae("iconSize"),height:ae("iconSize")},classes:"node-service"})})}function we(e,t){e.forEach(e=>{t.add({group:"nodes",data:{type:"junction",id:e.id,parent:e.in,width:ae("iconSize"),height:ae("iconSize")},classes:"node-junction"})})}function ke(e,t){t.nodes().map(t=>{const r=J(t);"group"!==r.type&&(r.x=t.position().x,r.y=t.position().y,e.getElementById(r.id).attr("transform","translate("+(r.x||0)+","+(r.y||0)+")"))})}function xe(e,t){e.forEach(e=>{t.add({group:"nodes",data:{type:"group",id:e.id,icon:e.icon,label:e.title,parent:e.in},classes:"node-group"})})}function be(e,t){e.forEach(e=>{const{lhsId:r,rhsId:i,lhsInto:s,lhsGroup:o,rhsInto:n,lhsDir:a,rhsDir:c,rhsGroup:d,title:l}=e,f=A(e.lhsDir,e.rhsDir)?"segments":"straight",h={id:`${r}-${i}`,label:l,source:r,sourceDir:a,sourceArrow:s,sourceGroup:o,sourceEndpoint:"L"===a?"0 50%":"R"===a?"100% 50%":"T"===a?"50% 0":"50% 100%",target:i,targetDir:c,targetArrow:n,targetGroup:d,targetEndpoint:"L"===c?"0 50%":"R"===c?"100% 50%":"T"===c?"50% 0":"50% 100%"};t.add({group:"edges",data:h,classes:f})})}function ve(t,r,i){const s=e((e,t)=>Object.entries(e).reduce((e,[r,s])=>{let o=0;const n=Object.entries(s);if(1===n.length)return e[r]=n[0][1],e;for(let a=0;a<n.length-1;a++)for(let s=a+1;s<n.length;s++){const[c,d]=n[a],[l,f]=n[s],h=i[c]?.[l];h===t||"default"===c||"default"===l?(e[r]??=[],e[r]=[...e[r],...d,...f]):(e[`${r}-${o++}`]=d,e[`${r}-${o++}`]=f)}return e},{}),"flattenAlignments"),o=r.map(e=>{const r={},i={};return Object.entries(e).forEach(([e,[s,o]])=>{const n=t.getNode(e)?.in??"default";r[o]??={},r[o][n]??=[],r[o][n].push(e),i[s]??={},i[s][n]??=[],i[s][n].push(e)}),{horiz:Object.values(s(r,"horizontal")).filter(e=>e.length>1),vert:Object.values(s(i,"vertical")).filter(e=>e.length>1)}}),[n,a]=o.reduce(([e,t],{horiz:r,vert:i})=>[[...e,...r],[...t,...i]],[[],[]]);return{horizontal:n,vertical:a}}function $e(t){const r=[],i=e(e=>`${e[0]},${e[1]}`,"posToStr"),s=e(e=>e.split(",").map(e=>parseInt(e)),"strToPos");return t.forEach(e=>{const t=Object.fromEntries(Object.entries(e).map(([e,t])=>[i(t),e])),o=[i([0,0])],n={},a={L:[-1,0],R:[1,0],T:[0,1],B:[0,-1]};for(;o.length>0;){const e=o.shift();if(e){n[e]=1;const c=t[e];if(c){const d=s(e);Object.entries(a).forEach(([e,s])=>{const a=i([d[0]+s[0],d[1]+s[1]]),l=t[a];l&&!n[a]&&(o.push(a),r.push({[T[e]]:l,[T[D(e)]]:c,gap:1.5*ae("iconSize")}))})}}}}),r}function Ee(t,r,i,s,o,{spatialMaps:n,groupAlignments:a}){return new Promise(c=>{const d=E("body").append("div").attr("id","cy").attr("style","display:none"),l=v({container:document.getElementById("cy"),style:[{selector:"edge",style:{"curve-style":"straight",label:"data(label)","source-endpoint":"data(sourceEndpoint)","target-endpoint":"data(targetEndpoint)"}},{selector:"edge.segments",style:{"curve-style":"segments","segment-weights":"0","segment-distances":[.5],"edge-distances":"endpoints","source-endpoint":"data(sourceEndpoint)","target-endpoint":"data(targetEndpoint)"}},{selector:"node",style:{"compound-sizing-wrt-labels":"include"}},{selector:"node[label]",style:{"text-valign":"bottom","text-halign":"center","font-size":`${ae("fontSize")}px`}},{selector:".node-service",style:{label:"data(label)",width:"data(width)",height:"data(height)"}},{selector:".node-junction",style:{width:"data(width)",height:"data(height)"}},{selector:".node-group",style:{padding:`${ae("padding")}px`}}]});d.remove(),xe(i,l),ye(t,l),we(r,l),be(s,l);const f=ve(o,n,a),h=$e(n),g=l.layout({name:"fcose",quality:"proof",styleEnabled:!1,animate:!1,nodeDimensionsIncludeLabels:!1,idealEdgeLength(e){const[t,r]=e.connectedNodes(),{parent:i}=J(t),{parent:s}=J(r);return i===s?1.5*ae("iconSize"):.5*ae("iconSize")},edgeElasticity(e){const[t,r]=e.connectedNodes(),{parent:i}=J(t),{parent:s}=J(r);return i===s?.45:.001},alignmentConstraint:f,relativePlacementConstraint:h});g.one("layoutstop",()=>{function t(e,t,r,i){let s,o;const{x:n,y:a}=e,{x:c,y:d}=t;o=(i-a+(n-r)*(a-d)/(n-c))/Math.sqrt(1+Math.pow((a-d)/(n-c),2)),s=Math.sqrt(Math.pow(i-a,2)+Math.pow(r-n,2)-Math.pow(o,2)),s/=Math.sqrt(Math.pow(c-n,2)+Math.pow(d-a,2));let l=(c-n)*(i-a)-(d-a)*(r-n);switch(!0){case l>=0:l=1;break;case l<0:l=-1}let f=(c-n)*(r-n)+(d-a)*(i-a);switch(!0){case f>=0:f=1;break;case f<0:f=-1}return o=Math.abs(o)*l,s*=f,{distances:o,weights:s}}e(t,"getSegmentWeights"),l.startBatch();for(const e of Object.values(l.edges()))if(e.data?.()){const{x:r,y:i}=e.source().position(),{x:s,y:o}=e.target().position();if(r!==s&&i!==o){const r=e.sourceEndpoint(),i=e.targetEndpoint(),{sourceDir:s}=Y(e),[o,n]=S(s)?[r.x,i.y]:[i.x,r.y],{weights:a,distances:c}=t(r,i,o,n);e.style("segment-distances",c),e.style("segment-weights",a)}}l.endBatch(),g.run()}),g.run(),l.ready(e=>{p.info("Ready",e),c(l)})})}y([{name:he.prefix,icons:he}]),v.use($),e(ye,"addServices"),e(we,"addJunctions"),e(ke,"positionNodes"),e(xe,"addGroups"),e(be,"addEdges"),e(ve,"getAlignments"),e($e,"getRelativeConstraints"),e(Ee,"layoutArchitecture");var Te={parser:de,db:ne,renderer:{draw:e(async(e,t,r,i)=>{const s=i.db,o=s.getServices(),n=s.getJunctions(),d=s.getGroups(),l=s.getEdges(),f=s.getDataStructures(),h=a(t),p=h.append("g");p.attr("class","architecture-edges");const g=h.append("g");g.attr("class","architecture-services");const u=h.append("g");u.attr("class","architecture-groups"),await ue(s,g,o),me(s,g,n);const m=await Ee(o,n,d,l,s,f);await pe(p,m),await ge(u,m),ke(s,m),c(void 0,h,ae("padding"),ae("useMaxWidth"))},"draw")},styles:le};export{Te as diagram};
